# è€åŒ—äº¬åŸå½±åƒä¿®å¤

æœ¬é¡¹ç›®è¿ç”¨[PaddleGAN](https://github.com/PaddlePaddle/PaddleGAN)å®ç°äº†ç™¾å¹´å‰è€åŒ—äº¬åŸè§†é¢‘çš„å¤åŸï¼Œå…¶ä¸­å°†è¯¦ç»†è®²è§£å¦‚ä½•è¿ç”¨è§†é¢‘çš„ä¸Šè‰²ã€è¶…åˆ†è¾¨ç‡ï¼ˆæé«˜æ¸…æ™°åº¦ï¼‰ã€æ’å¸§ï¼ˆæé«˜æµç•…åº¦ï¼‰ç­‰AIä¿®å¤æŠ€æœ¯ï¼Œè®©é‚£äº›å…ˆè¾ˆä»¬çš„ä¸€ä¸¾ä¸€åŠ¨ï¼Œä¸€é¢¦ä¸€ç°‡éƒ½å®›è‹¥çœ¼å‰ä¹‹äººã€‚

å½“ç„¶ï¼Œå¦‚æœå¤§å®¶è§‰å¾—è¿™ä¸ªé¡¹ç›®æœ‰è¶£å¥½ç”¨çš„è¯ï¼Œå¸Œæœ›å¤§å®¶èƒ½å¤Ÿä¸ºæˆ‘ä»¬[PaddleGAN](https://github.com/PaddlePaddle/PaddleGAN)çš„[Githubä¸»é¡µ](https://github.com/PaddlePaddle/PaddleGAN)ç‚¹Starå™¢~

<div align='center'>
  <img src='https://ai-studio-static-online.cdn.bcebos.com/47cea097a0284dd39fc2804a53aa8ee6dad16ffe104641258046eb05af49cd64' width='1000'/>
</div>

</br>
<div align='center'>
  <img src='https://ai-studio-static-online.cdn.bcebos.com/99da82cb4c0143dfa45e40c5eb13dd4543ab55daf70f4313b81eef434d1a1ff7' width='800'/>
</div>

## å®‰è£…PaddleGAN

PaddleGANçš„å®‰è£…ç›®å‰æ”¯æŒClone GitHubå’ŒGiteeä¸¤ç§æ–¹å¼ï¼š


```python
# å®‰è£…ppgan
# å½“å‰ç›®å½•åœ¨: /home/aistudio/, è¿™ä¸ªç›®å½•ä¹Ÿæ˜¯å·¦è¾¹æ–‡ä»¶å’Œæ–‡ä»¶å¤¹æ‰€åœ¨çš„ç›®å½•
# å…‹éš†æœ€æ–°çš„PaddleGANä»“åº“åˆ°å½“å‰ç›®å½•
# !git clone https://github.com/PaddlePaddle/PaddleGAN.git
# å¦‚æœä»githubä¸‹è½½æ…¢å¯ä»¥ä»gitee cloneï¼š
!git clone https://gitee.com/paddlepaddle/PaddleGAN.git
%cd PaddleGAN/
!pip install -v -e .
```

    Cloning into 'PaddleGAN'...
    remote: Enumerating objects: 2977, done.[K
    remote: Counting objects: 100% (2977/2977), done.[K
    remote: Compressing objects: 100% (1741/1741), done.[K
    Receiving objects:  46% (1389/2977), 1.53 MiB | 371.00 KiB/s     

## PaddleGANä¸­è¦ä½¿ç”¨çš„é¢„æµ‹æ¨¡å‹ä»‹ç»
### è¡¥å¸§æ¨¡å‹DAIN
DAIN æ¨¡å‹é€šè¿‡æ¢ç´¢æ·±åº¦çš„ä¿¡æ¯æ¥æ˜¾å¼æ£€æµ‹é®æŒ¡ã€‚å¹¶ä¸”å¼€å‘äº†ä¸€ä¸ªæ·±åº¦æ„ŸçŸ¥çš„æµæŠ•å½±å±‚æ¥åˆæˆä¸­é—´æµã€‚åœ¨è§†é¢‘è¡¥å¸§æ–¹é¢æœ‰è¾ƒå¥½çš„æ•ˆæœã€‚
![](./images/dain_network.png)

```
ppgan.apps.DAINPredictor(
                        output_path='output',
                        weight_path=None,
                        time_step=None,
                        use_gpu=True,
                        remove_duplicates=False)
```
#### å‚æ•°

- `output_path (strï¼Œå¯é€‰çš„)`: è¾“å‡ºçš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œé»˜è®¤å€¼ï¼š`output`.
- `weight_path (Noneï¼Œå¯é€‰çš„)`: è½½å…¥çš„æƒé‡è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä»äº‘ç«¯ä¸‹è½½é»˜è®¤çš„æƒé‡åˆ°æœ¬åœ°ã€‚é»˜è®¤å€¼ï¼š`None`ã€‚
- `time_step (int)`: è¡¥å¸§çš„æ—¶é—´ç³»æ•°ï¼Œå¦‚æœè®¾ç½®ä¸º0.5ï¼Œåˆ™åŸå…ˆä¸ºæ¯ç§’30å¸§çš„è§†é¢‘ï¼Œè¡¥å¸§åå˜ä¸ºæ¯ç§’60å¸§ã€‚
- `remove_duplicates (boolï¼Œå¯é€‰çš„)`: æ˜¯å¦åˆ é™¤é‡å¤å¸§ï¼Œé»˜è®¤å€¼ï¼š`False`.

### ä¸Šè‰²æ¨¡å‹DeOldifyPredictor
DeOldify é‡‡ç”¨è‡ªæ³¨æ„åŠ›æœºåˆ¶çš„ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼Œç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªU-NETç»“æ„çš„ç½‘ç»œã€‚åœ¨å›¾åƒçš„ä¸Šè‰²æ–¹é¢æœ‰ç€è¾ƒå¥½çš„æ•ˆæœã€‚
![](./images/deoldify_network.png)

```
ppgan.apps.DeOldifyPredictor(output='output', weight_path=None, render_factor=32)
```
#### å‚æ•°

- `output_path (strï¼Œå¯é€‰çš„)`: è¾“å‡ºçš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œé»˜è®¤å€¼ï¼š`output`.
- `weight_path (Noneï¼Œå¯é€‰çš„)`: è½½å…¥çš„æƒé‡è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä»äº‘ç«¯ä¸‹è½½é»˜è®¤çš„æƒé‡åˆ°æœ¬åœ°ã€‚é»˜è®¤å€¼ï¼š`None`ã€‚
- `render_factor (int)`: ä¼šå°†è¯¥å‚æ•°ä¹˜ä»¥16åä½œä¸ºè¾“å…¥å¸§çš„resizeçš„å€¼ï¼Œå¦‚æœè¯¥å€¼è®¾ç½®ä¸º32ï¼Œ
                         åˆ™è¾“å…¥å¸§ä¼šresizeåˆ°(32 * 16, 32 * 16)çš„å°ºå¯¸å†è¾“å…¥åˆ°ç½‘ç»œä¸­ã€‚

### ä¸Šè‰²æ¨¡å‹DeepRemasterPredictor
DeepRemaster æ¨¡å‹åŸºäºæ—¶ç©ºå·ç§¯ç¥ç»ç½‘ç»œå’Œè‡ªæ³¨æ„åŠ›æœºåˆ¶ã€‚å¹¶ä¸”èƒ½å¤Ÿæ ¹æ®è¾“å…¥çš„ä»»æ„æ•°é‡çš„å‚è€ƒå¸§å¯¹å›¾ç‰‡è¿›è¡Œä¸Šè‰²ã€‚
![](./images/remaster_network.png)

```
ppgan.apps.DeepRemasterPredictor(
                                output='output',
                                weight_path=None,
                                colorization=False,
                                reference_dir=None,
                                mindim=360):
```
#### å‚æ•°

- `output_path (strï¼Œå¯é€‰çš„)`: è¾“å‡ºçš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œé»˜è®¤å€¼ï¼š`output`.
- `weight_path (Noneï¼Œå¯é€‰çš„)`: è½½å…¥çš„æƒé‡è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä»äº‘ç«¯ä¸‹è½½é»˜è®¤çš„æƒé‡åˆ°æœ¬åœ°ã€‚é»˜è®¤å€¼ï¼š`None`ã€‚
- `colorization (bool)`: æ˜¯å¦å¯¹è¾“å…¥è§†é¢‘ä¸Šè‰²ï¼Œå¦‚æœé€‰é¡¹è®¾ç½®ä¸º `True` ï¼Œåˆ™å‚è€ƒå¸§çš„æ–‡ä»¶å¤¹è·¯å¾„ä¹Ÿå¿…é¡»è¦è®¾ç½®ã€‚é»˜è®¤å€¼ï¼š`False`ã€‚
- `reference_dir (bool)`: å‚è€ƒå¸§çš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚é»˜è®¤å€¼ï¼š`None`ã€‚
- `mindim (bool)`: è¾“å…¥å¸§é‡æ–°resizeåçš„çŸ­è¾¹çš„å¤§å°ã€‚é»˜è®¤å€¼ï¼š360ã€‚

### è¶…åˆ†è¾¨ç‡æ¨¡å‹RealSRPredictor
RealSRæ¨¡å‹é€šè¿‡ä¼°è®¡å„ç§æ¨¡ç³Šå†…æ ¸ä»¥åŠå®é™…å™ªå£°åˆ†å¸ƒï¼Œä¸ºç°å®ä¸–ç•Œçš„å›¾åƒè®¾è®¡ä¸€ç§æ–°é¢–çš„çœŸå®å›¾ç‰‡é™é‡‡æ ·æ¡†æ¶ã€‚åŸºäºè¯¥é™é‡‡æ ·æ¡†æ¶ï¼Œå¯ä»¥è·å–ä¸çœŸå®ä¸–ç•Œå›¾åƒå…±äº«åŒä¸€åŸŸçš„ä½åˆ†è¾¨ç‡å›¾åƒã€‚å¹¶ä¸”æå‡ºäº†ä¸€ä¸ªæ—¨åœ¨æé«˜æ„ŸçŸ¥åº¦çš„çœŸå®ä¸–ç•Œè¶…åˆ†è¾¨ç‡æ¨¡å‹ã€‚å¯¹åˆæˆå™ªå£°æ•°æ®å’ŒçœŸå®ä¸–ç•Œå›¾åƒè¿›è¡Œçš„å¤§é‡å®éªŒè¡¨æ˜ï¼Œè¯¥æ¨¡å‹èƒ½å¤Ÿæœ‰æ•ˆé™ä½äº†å™ªå£°å¹¶æé«˜äº†è§†è§‰è´¨é‡ã€‚

![](./images/realsr_network.png)

```
ppgan.apps.RealSRPredictor(output='output', weight_path=None)
```
#### å‚æ•°

- `output_path (strï¼Œå¯é€‰çš„)`: è¾“å‡ºçš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œé»˜è®¤å€¼ï¼š`output`.
- `weight_path (Noneï¼Œå¯é€‰çš„)`: è½½å…¥çš„æƒé‡è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä»äº‘ç«¯ä¸‹è½½é»˜è®¤çš„æƒé‡åˆ°æœ¬åœ°ã€‚é»˜è®¤å€¼ï¼š`None`ã€‚

### è¶…åˆ†è¾¨ç‡æ¨¡å‹EDVRPredictor
EDVRæ¨¡å‹æå‡ºäº†ä¸€ä¸ªæ–°é¢–çš„è§†é¢‘å…·æœ‰å¢å¼ºå¯å˜å½¢å·ç§¯çš„è¿˜åŸæ¡†æ¶ï¼šç¬¬ä¸€ï¼Œä¸ºäº†å¤„ç†å¤§åŠ¨ä½œè€Œè®¾è®¡çš„ä¸€ä¸ªé‡‘å­—å¡”ï¼Œçº§è”å’Œå¯å˜å½¢ï¼ˆPCDï¼‰å¯¹é½æ¨¡å—ï¼Œä½¿ç”¨å¯å˜å½¢å·ç§¯ä»¥ä»ç²—åˆ°ç²¾çš„æ–¹å¼åœ¨ç‰¹å¾çº§åˆ«å®Œæˆå¯¹é½ï¼›ç¬¬äºŒï¼Œæå‡ºæ—¶ç©ºæ³¨æ„åŠ›æœºåˆ¶ï¼ˆTSAï¼‰èåˆæ¨¡å—ï¼Œåœ¨æ—¶é—´å’Œç©ºé—´ä¸Šéƒ½èåˆäº†æ³¨æ„æœºåˆ¶ï¼Œç”¨ä»¥å¢å¼ºå¤åŸçš„åŠŸèƒ½ã€‚
![](./images/edvr_network.png)

```
ppgan.apps.EDVRPredictor(output='output', weight_path=None)
```
#### å‚æ•°

- `output_path (strï¼Œå¯é€‰çš„)`: è¾“å‡ºçš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œé»˜è®¤å€¼ï¼š`output`.
- `weight_path (Noneï¼Œå¯é€‰çš„)`: è½½å…¥çš„æƒé‡è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä»äº‘ç«¯ä¸‹è½½é»˜è®¤çš„æƒé‡åˆ°æœ¬åœ°ã€‚é»˜è®¤å€¼ï¼š`None`ã€‚

## ä½¿ç”¨PaddleGANè¿›è¡Œè§†é¢‘ä¿®å¤


```python
# å¯¼å…¥ä¸€äº›å¯è§†åŒ–éœ€è¦çš„åŒ…
import cv2
import imageio
import numpy as np
import matplotlib.pyplot as plt
import matplotlib.animation as animation
from IPython.display import HTML
import warnings
warnings.filterwarnings("ignore")
```


```python
# å®šä¹‰ä¸€ä¸ªå±•ç¤ºè§†é¢‘çš„å‡½æ•°
def display(driving, fps, size=(8, 6)):
    fig = plt.figure(figsize=size)

    ims = []
    for i in range(len(driving)):
        cols = []
        cols.append(driving[i])

        im = plt.imshow(np.concatenate(cols, axis=1), animated=True)
        plt.axis('off')
        ims.append([im])

    video = animation.ArtistAnimation(fig, ims, interval=1000.0/fps, repeat_delay=1000)

    plt.close()
    return video
```


```python
# å±•ç¤ºä¸€ä¸‹è¾“å…¥çš„è§†é¢‘, å¦‚æœè§†é¢‘å¤ªå¤§ï¼Œæ—¶é—´ä¼šéå¸¸ä¹…ï¼Œå¯ä»¥è·³è¿‡è¿™ä¸ªæ­¥éª¤
video_path = '/home/aistudio/Peking_input360p_clip6_5s.mp4'
video_frames = imageio.mimread(video_path, memtest=False)

# è·å¾—è§†é¢‘çš„åŸåˆ†è¾¨ç‡
cap = cv2.VideoCapture(video_path)
fps = cap.get(cv2.CAP_PROP_FPS)
    

HTML(display(video_frames, fps).to_html5_video())
```


```python
# ä½¿ç”¨æ’å¸§(DAIN), ä¸Šè‰²(DeOldify), è¶…åˆ†(EDVR)è¿™ä¸‰ä¸ªæ¨¡å‹å¯¹è¯¥è§†é¢‘è¿›è¡Œä¿®å¤
# inputå‚æ•°è¡¨ç¤ºè¾“å…¥çš„è§†é¢‘è·¯å¾„
# outputè¡¨ç¤ºå¤„ç†åçš„è§†é¢‘çš„å­˜æ”¾æ–‡ä»¶å¤¹
# proccess_order è¡¨ç¤ºä½¿ç”¨çš„æ¨¡å‹å’Œé¡ºåºï¼ˆç›®å‰æ”¯æŒï¼‰
%cd /home/aistudio/PaddleGAN/applications/
!python tools/video-enhance.py --input /home/aistudio/Peking_input360p_clip6_5s.mp4 \
                               --process_order DAIN DeOldify EDVR \
                               --output output_dir
```


```python
# å±•ç¤ºä¸€ä¸‹å¤„ç†å¥½çš„è§†é¢‘, å¦‚æœè§†é¢‘å¤ªå¤§ï¼Œæ—¶é—´ä¼šéå¸¸ä¹…ï¼Œå¯ä»¥ä¸‹è½½ä¸‹æ¥çœ‹
# è¿™ä¸ªè·¯å¾„å¯ä»¥æŸ¥çœ‹ä¸Šä¸ªcode cellçš„æœ€åæ‰“å°çš„output video path
output_video_path = '/home/aistudio/PaddleGAN/applications/output_dir/EDVR/Peking_input360p_clip6_5s_deoldify_out_edvr_out.mp4'

video_frames = imageio.mimread(output_video_path, memtest=False)

# è·å¾—è§†é¢‘çš„åŸåˆ†è¾¨ç‡
cap = cv2.VideoCapture(output_video_path)
fps = cap.get(cv2.CAP_PROP_FPS)
    

HTML(display(video_frames, fps, size=(16, 12)).to_html5_video())
```
